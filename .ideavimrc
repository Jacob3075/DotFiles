se ignorecase
set smartcase
set scrolloff=10 " 10 lines above/below cursor when scrolling
set number relativenumber
set hlsearch
set incsearch
set showmode
set showcmd
set history=100000
set nu
set clipboard+=unnamedplus, ideaput, autoselect
set matchpairs
set startofline
set timeout 500
" set notimeout

let mapleader = " "

" Enable Plugins
	set surround
	set multiple-cursors
	set commentary
	set argtextobj
	" set easymotion
	" set sneak
	set exchange
	set textobj-entire
	set ReplaceWithRegister
	set NERDTree
	set highlightedyank
	set which-key
	set vim-paragraph-motion

" Plugin Settings
	" let g:EasyMotion_do_mapping=0
	let g:argtextobj_pairs="[:],(:),<:>,{:}"

" Idea Settings
	set ideajoin
	set idearefactormode=keep

" Insert mode shortcut
	inoremap <C-h> <Left>
	inoremap <C-j> <Down>
	inoremap <C-k> <Up>
	inoremap <C-l> <Right>
	inoremap <C-a> <Home>
	inoremap <C-e> <End>
	inoremap <C-d> <Delete>

    nnoremap <CR><CR> :action ShowIntentionActions<CR>
    noremap <leader>= :action ReformatCode<CR>

" Quit insert mode
	inoremap jk <Esc>
	inoremap jj <Esc>
	inoremap kj <Esc>
	inoremap kk <Esc>

" Movement Keys
    nnoremap <C-w> :action EditorNextWord<cr>
    nnoremap <C-b> :action EditorPreviousWord<cr>
    vnoremap <C-w> :action EditorNextWordWithSelection<cr>
    vnoremap <C-b> :action EditorPreviousWordWithSelection<cr>

" Quit visual mode
	vnoremap v <Esc>
	nnoremap <leader><Esc> :nohlsearch<CR>

" Move to the start and end of the line
	nnoremap H ^
	nnoremap L $
	vnoremap H ^
	vnoremap L $

" Use Q for formatting the current paragraph (or visual selection)
	vmap Q gq
	nmap Q gqap
	
" These create newlines like o and O but stay in normal mode
	nmap zj o<Esc>k
	nmap zk O<Esc>j

" Key bindings for quickly moving between windows
	" h left, l right, k up, j down
	nmap <leader>h <c-w>h
	nmap <leader>l <c-w>l
	nmap <leader>k <c-w>k
	nmap <leader>j <c-w>j

" Closing tabs
	nnoremap <leader>cb :action CloseContent<cr>
	nnoremap <leader>ca :action CloseAllEditors<cr>
	nnoremap <leader>co :action CloseAllEditorsButActive<cr>
	nnoremap <leader>cp :action CloseProject<cr>
	nnoremap <leader>C :action ReopenClosedTab<cr>

" To navigate between split panes
	nnoremap <leader>wn :action NextSplitter<cr>
	nnoremap <leader>wp :action PrevSplitter<cr>
	nnoremap <C-h> :action PrevSplitter<cr>
	nnoremap <C-l> :action NextSplitter<cr>

" Splits manipulation
	nmap <leader>wh :action SplitHorizontally<cr>
	nmap <leader>wv :action SplitVertically<cr>
	nmap <leader>wc :action Unsplit<cr>
	nmap <leader>wC :action UnsplitAll<cr>
	nmap <leader>wd :action OpenEditorInOppositeTabGroup<cr>
	nmap <leader>ww :action JumpToLastWindow<cr>
	nnoremap <C-S-h> :action StretchSplitToLeft<cr>
	nnoremap <C-S-l> :action StretchSplitToRight<cr>

" Remapped Search
	nnoremap / :action Find<CR>
	nnoremap <leader>/ /

	nmap <leader><leader> :action RecentFiles<cr>
	nmap <leader>I :action SelectIn<cr>
	map <leader>S :action SurroundWith<cr>
	nmap ,,  :action RecentLocations<cr>
	" nmap ,,  :action HideAllWindows<cr>
	nmap \\\\ :action FileStructurePopup<cr>

" Navigation
	nnoremap <Tab> :action NextTab<cr>
	nnoremap <S-Tab> :action PreviousTab<cr>
	nnoremap <C-Tab> :tabm +1<cr>
	nnoremap <C-S-Tab> :tabm -1<cr>
	nnoremap <leader>. <C-^><cr>

" AceJump
	nnoremap f :action AceAction<cr>
	nmap <leader>af :action AceAction<cr>
	nmap <leader>aF :action AceReverseAction<cr>
	nmap <leader>ad :action AceDeclarationAction <cr>
	nmap <leader>al :action AceLineStartsAction <cr>
	nmap <leader>ai :action AceLineIndentsAction <cr>
	nmap <leader>aL :action AceLineEndsAction <cr>
	nmap <leader>at :action AceTargetAction <cr>
	" nmap t <Plug>(easymotion-t)
	" nmap T <Plug>(easymotion-T)

" GoTo
	nmap <leader>gi :action GotoImplementation<cr>
	nmap <leader>gd :action GotoDeclaration<cr>
	nmap <leader>gR :action GotoRelated<cr>
	nmap <leader>gt :action GotoTest<cr>

" Find
	nmap <leader>ff :action GotoFile<cr>
	nmap <leader>fs :action GotoSymbol<cr>
	nmap <leader>fa :action GotoAction<cr>
	nmap <leader>fc :action GotoClass<cr>
	nmap <leader>fu :action FindUsages<cr>
	nmap <leader>fU :action FindUsagesInFile<cr>

" Show
	nnoremap <leader>su :action ShowUsages<cr>
	nnoremap <leader>sU :action FindUsagesInFile<cr>
	nnoremap <leader>sb :action ShowBookmarks<cr>
	nnoremap <leader>si :action QuickImplementations<cr>
	noremap <Space>sm :action ShowPopupMenu<CR>

" Bookmarks
    nnoremap <leader>mT :action ToggleBookmarkWithMnemonic<cr>
    nnoremap <leader>mt :action ToggleBookmark<cr>
    nnoremap <leader>me :action EditBookmark<cr>
    nnoremap <leader>mg :action Bookmarks.Goto<cr>

" Breakpoint
    nnoremap <leader>bb :action ToggleLineBreakpoint<cr>
    nnoremap <leader>bt :action ToggleBreakpointEnabled<cr>
    nnoremap <leader>be :action EditBreakpoint<cr>
    nnoremap <leader>ba :action BreakpointActionsGroup<cr>
    nnoremap <leader>bv :action ViewBreakpoints<cr>

" Refactorings
	noremap <leader>R :action Refactorings.QuickListPopupAction<cr>
	noremap <leader>rr :action RenameElement<cr>
	noremap <leader>rR :action Replace<cr>
	noremap <leader>rI :action OptimizeImports<cr>
	noremap <leader>rc :action IntroduceConstant<cr>
	noremap <leader>rv :action IntroduceVariable<cr>
	noremap <leader>rf :action IntroduceField<cr>
	noremap <leader>rF :action IntroduceProperty<cr>
	noremap <leader>rp :action IntroduceParameter<cr>
	noremap <leader>rm :action ExtractMethod<cr>
	noremap <leader>rs :action ChangeSignature<cr>
	noremap <leader>rw :action Flutter.ExtractWidgetToFile<cr>
	noremap <leader>ri :action Inline<cr>

" Generate
	nmap <leader>ggg :action Generate<cr>
	nmap <leader>ggo :action OverrideMethods<cr>
	nmap <leader>ggi :action ImplementMethods<cr>

" Inspection
	nmap <leader>ic :action InspectCode<cr>

" VCS operations
	nmap <leader>vc :action Vcs.Show.Local.Changes<cr>
	nmap <leader>vp :action Vcs.Push<cr>
	nmap <leader>vu :action Vcs.UpdateProject<cr>
	nmap <leader>vm :action Vcs.QuickListPopupAction<cr>
	nmap <leader>va :action Annotate<cr>
	nmap <leader>vl :action Vcs.Show.Log<cr>
	nmap <leader>vd :action Compare.LastVersion<cr>
	nmap <leader>vr :action Vcs.RollbackChangedLines<cr>
	" nmap <leader>yr :action Git.ResolveConflicts<cr>

" Flutter
    nnoremap <leader>Fw :action Flutter.ExtractWidget<cr>
    nnoremap <leader>FW :action Flutter.ExtractWidgetToFile<cr>
    nnoremap <leader>Fn :action Flutter.NewWidget<cr>
    nnoremap <leader>Fg :action flutter.pub.get<cr>
    nnoremap <leader>Fbb :action cn.neday.excavator.action.generation.BuildAction<cr>
    nnoremap <leader>FbB :action cn.neday.excavator.action.generation.RebuildAction<cr>
    nnoremap <leader>Fbw :action cn.neday.excavator.action.generation.WatchAction<cr>
    nnoremap <leader>Fbc :action cn.neday.excavator.action.generation.CleanAction<cr>
    nnoremap <leader>Fbk :action cn.neday.excavator.action.kill.FlutterKillAction<cr>

" unimpaired mappings - from https://github.com/saaguero/ideavimrc/blob/master/.ideavimrc
	nnoremap [<space> O<esc>j
	nnoremap ]<space> o<esc>k

	nnoremap [[ :action Back<cr>
	nnoremap ]] :action Forward<cr>

    " https://youtrack.jetbrains.com/issue/VIM-2225/IdeaVim-in-Rider-action-Back-behaves-incorrectly#focus=Comments-27-4829085.0-0
	" nnoremap [[ <Action>(Back)
	" nnoremap ]] <Action>(Forward)

	" nnoremap [{ :action EditorCodeBlockStart<cr>
	" nnoremap ]} :action EditorCodeBlockEnd<cr>

	nnoremap [m :action MethodUp<cr>
	nnoremap ]m :action MethodDown<cr>

	nnoremap [c :action VcsShowPrevChangeMarker<cr>
	nnoremap ]c :action VcsShowNextChangeMarker<cr>

" Errors
	nnoremap [e :action GotoPreviousError<cr>
	nnoremap ]e :action GotoNextError<cr>
	nnoremap <leader>ed :action ShowErrorDescription<cr>

" Tabs
	nnoremap [b :action PreviousTab<cr>
	nnoremap ]b :action NextTab<cr>

" Tabs
	nnoremap [B :action GotoPreviousBookmark<cr>
	nnoremap ]B :action GotoNextBookmark<cr>

" Occurrence
    nnoremap [w #:nohlsearch<cr>
    nnoremap ]w *:nohlsearch<cr>

" Search
	nnoremap <leader>\ :action FindInPath<cr>

" Moving statements
	nnoremap [s :action MoveStatementUp<cr>
	nnoremap ]s :action MoveStatementDown<cr>

" Building, Running and Debugging
	nnoremap ,s :action Stop<cr>
	nnoremap ,r :action Run<cr>
	nnoremap ,b :action BuildMenu<cr>
	nnoremap ,dd :action Debug<cr>
	nnoremap ,c :action RunClass<cr>
	nnoremap ,dc : DebugClass<cr>
	nnoremap ,t :action ShowRecentTests<cr>

" AMII
    nnoremap <leader>;ad :action amii.discreet-mode<cr>
    nnoremap <leader>;am :action AMIIActions<cr>

" String Manipulation
    noremap <leader>;sc :action StringManipulation.Group.SwitchCase<cr>
    noremap <leader>;sm :action StringManipulation.Group.Main<cr>
    noremap <leader>;sC :action StringManipulation.ToCamelCase<cr>

" Local History
    nnoremap <leader>;hs :action LocalHistory.ShowHistory<cr>
    vnoremap <leader>;hs :action LocalHistory.ShowSelectionHistory<cr>

" EasyMotion
	" nmap f <Plug>(easymotion-f)
	" nmap F <Plug>(easymotion-F)
	" nmap t <Plug>(easymotion-t)
	" nmap T <Plug>(easymotion-T)

sethandler <S-Tab> a:vim
sethandler <C-A>   a:vim
sethandler <C-B>   a:vim
sethandler <C-C>   a:vim
sethandler <C-D>   a:vim
sethandler <C-E>   a:vim
sethandler <C-H>   a:vim
sethandler <C-S-H> a:vim
sethandler <C-J>   a:vim
sethandler <C-K>   a:vim
sethandler <C-L>   a:vim
sethandler <C-S-L> a:vim
sethandler <C-M>   a:vim
sethandler <C-N>   a:vim
sethandler <C-O>   a:vim
sethandler <C-P>   a:vim
sethandler <C-Q>   a:ide
sethandler <C-R>   a:vim
sethandler <C-V>   a:vim
sethandler <C-W>   a:vim
sethandler <C-X>   a:vim
